<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analyzing inForm data • phenoptrReports</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Analyzing inForm data">
<meta property="og:description" content="phenoptrReports">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">phenoptrReports</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/consolidation.html">Consolidating inForm data</a>
    </li>
    <li>
      <a href="../articles/analysis.html">Analyzing inForm data</a>
    </li>
    <li>
      <a href="../articles/spatial_map_viewer.html">Visualizing spatial relationships</a>
    </li>
    <li>
      <a href="../articles/unmixing_quality_report.html">Unmixing quality report</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../news/index.html">
    <span class="fas fa-newspaper-o"></span>
     
    news
  </a>
</li>
<li>
  <a href="https://github.com/akoyabio/phenoptrReports">
    <span class="fas fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="analysis_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Analyzing inForm data</h1>
                        <h4 class="author">Kent Johnson</h4>
            
            <h4 class="date">2021-06-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/akoyabio/phenoptrReports/blob/master/vignettes/analysis.Rmd"><code>vignettes/analysis.Rmd</code></a></small>
      <div class="hidden name"><code>analysis.Rmd</code></div>

    </div>

    
    
<div id="analysis-overview" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-overview" class="anchor"></a>Analysis overview</h2>
<p>A <code>phenoptrReports</code> analysis aggregates cell phenotypes and marker expression for each slide and tissue category in an experiment. An analysis can aggregate phenoype counts, density, mean expression and H-Score.</p>
<p>There are three parts to creating an analysis:</p>
<ul>
<li>select the input files</li>
<li>define the desired analysis</li>
<li>create the final reports</li>
</ul>
<div id="data-requirements" class="section level3">
<h3 class="hasAnchor">
<a href="#data-requirements" class="anchor"></a>Data requirements</h3>
<div id="consolidated-cell-seg-data" class="section level4">
<h4 class="hasAnchor">
<a href="#consolidated-cell-seg-data" class="anchor"></a>Consolidated cell seg data</h4>
<p>The primary source data for the analysis report is a consolidated data file created by the <em>Consolidate and summarize</em> app.</p>
<p>If you have only one merge file, from a single inForm project, you should still use <em>Consolidate and summarize</em> to convert the file to the format used by the analysis report.</p>
</div>
<div id="other-files" class="section level4">
<h4 class="hasAnchor">
<a href="#other-files" class="anchor"></a>Other files</h4>
<p>Two other input files are optional.</p>
<p>If provided, <code>phenotprReports</code> will use a merged cell seg summary file to compute tissue area and cell density within tissue categories. A score data summary file is used to compute H-Score per slide and tissue category.</p>
</div>
</div>
</div>
<div id="detailed-steps" class="section level2">
<h2 class="hasAnchor">
<a href="#detailed-steps" class="anchor"></a>Detailed steps</h2>
<div id="start-the-analysis-app" class="section level3">
<h3 class="hasAnchor">
<a href="#start-the-analysis-app" class="anchor"></a>Start the analysis app</h3>
<p>Choose “Analyze consolidated data” from the RStudio Addins menu to open the analysis app.</p>
<p><img src="figures/Analyze_addin.png"></p>
</div>
<div id="select-input-files" class="section level3">
<h3 class="hasAnchor">
<a href="#select-input-files" class="anchor"></a>Select input files</h3>
<p>The first tab in the analysis app is Files. Use this tab to select the input files and output directory for your analysis.</p>
<ol style="list-style-type: decimal">
<li><p>First, click the first Browse… button to select the consolidated data file created in the consolidation app. This is the most important input file and the only one that is required.</p></li>
<li><p>Next, click the second Browse… button. Select a directory to contain the results of the analysis.</p></li>
<li><p>To include cell densities in the analysis, click the third Browse… button and select a merged summary cell seg data file. The summary cell seg file includes information about tissue category area which is needed by the density calculation.</p></li>
<li><p>If your analysis includes H-Score, click the last Browse… button to select a score data file. The analysis will use the thresholds and markers in the score file to compute H-Score for each slide in the experiment.</p></li>
</ol>
<p><img src="figures/Analysis_files.png" style="height: 500px;"></p>
</div>
<div id="define-the-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#define-the-analysis" class="anchor"></a>Define the analysis</h3>
<p>The second tab in the analysis app is Analysis. It contains sections where you select tissue categories, phenotypes, and markers of interest.</p>
<div id="tissue-categories" class="section level4">
<h4 class="hasAnchor">
<a href="#tissue-categories" class="anchor"></a>Tissue categories</h4>
<p>In this section, select the tissue categories to include in the analysis.</p>
<p><img src="figures/Tissue_categories.png"></p>
</div>
<div id="slide-id-prefix" class="section level4">
<h4 class="hasAnchor">
<a href="#slide-id-prefix" class="anchor"></a>Slide ID prefix</h4>
<p>The Slide IDs in your data file may contain prefix information that is not wanted in the final report. Any text you enter here will be removed from the start of the Slide IDs. The text can be either an exact match or a <a href="http://r4ds.had.co.nz/strings.html#matching-patterns-with-regular-expressions">regular expression</a>. Exact matches will match from the start of the Slide ID. Regular expressions will match anywhere in the Slide ID; to match only from the start, start the regular expression with <code><a href="https://rdrr.io/r/base/Arithmetic.html">^</a></code>.</p>
<p>Leave this field blank to use the existing Slide IDs unchanged.</p>
<p><img src="figures/Slide_id_prefix.png"></p>
</div>
<div id="define-phenotypes-and-markers" class="section level4">
<h4 class="hasAnchor">
<a href="#define-phenotypes-and-markers" class="anchor"></a>Define phenotypes and markers</h4>
<p>In this section you define the phenotypes and markers of interest. Every phenotype defined in this section will be included in the Cell Counts, Cell Percents and Cell Density sections of the final report. Phenotypes for which you select an expression marker will also be included in the Mean Expression section of the report.</p>
<p>The available phenotypes are shown at the top of the section. These are the phenotype names you can use in your phenotype definitions.</p>
<p>In the “Phenotype” box, enter the definition of a phenotype of interest. You can enter a single or multiple phenotype.</p>
<p>To analyze a single phenotype, enter the phenotype name with a + or -, for example CD3+ or CD8-.</p>
<p>To analyze a multiple phenotype, combine individual phenotype definitions with slash (/) or comma (,). Combine with a slash to define double positive phenotypes, for example CD3+/CD8+. Combine with a comma to allow either phenotype, for example CD68+,CD163+.</p>
<p>To compute mean expression of a marker for a phenotype, select the marker of interest in the Expression drop-down.</p>
<p>To compute expression of multiple markers for a single phenotype, add a duplicate phenotype with the second marker selected. To compute expression of a marker for all cells, enter “Total Cells” as the phenotype.</p>
<p><img src="figures/Phenotypes.png"></p>
</div>
</div>
<div id="h-score-for-individual-phenotypes" class="section level3">
<h3 class="hasAnchor">
<a href="#h-score-for-individual-phenotypes" class="anchor"></a>H-Score for individual phenotypes</h3>
<p>If you selected a score summary file in the Files tab, the phenotype selections will include a “Score” checkbox. If this is checked, the generated report will include H-Score for the selected phenotype in addition to the H-Score for all cells.</p>
<p><img src="figures/Phenotypes_with_score.png"></p>
</div>
<div id="select-options-for-spatial-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#select-options-for-spatial-analysis" class="anchor"></a>Select options for spatial analysis</h3>
<p>In this section, select the types of spatial analysis to include.</p>
<ul>
<li><p><strong>Include nearest neighbor summary</strong> If this is selected, the generated report will include a table summarizing nearest neighbor distances between every pair of phenotypes and heatmap visualizations of the mean distances.</p></li>
<li><p><strong>Include “count within radius” summary</strong> If this is selected, the generated report will include a table summarizing, for each pair of phenotypes, the number of cells of a phenotype having a cell of a second phenotype within a specified radius. Enter the radius or radii of interest in the text field.</p></li>
<li>
<p><strong>Save nearest neighbor / count within details</strong></p>
<ul>
<li>If this is selected with “Include nearest neighbor summary”, the analysis will write a <code>nearest_neighbors.txt</code> file containing, for each cell, the distance to the nearest cell of each phenotype and the cell ID of the cell.</li>
<li>If this is selected with “Include ‘count within radius’ summary”, the analysis will write a <code>count_within.txt</code> file containing, for each cell, the count of cells within the specified radii.</li>
<li>These files may be useful for more detailed statistical analysis of spatial relationships.</li>
</ul>
</li>
</ul>
<p><img src="figures/Spatial_options.png"></p>
</div>
<div id="create-reports" class="section level3">
<h3 class="hasAnchor">
<a href="#create-reports" class="anchor"></a>Create reports</h3>
<p>The final tab in the analysis app is the Run tab. Click “Create Report” to run the displayed R script to create the final reports. Wait for the script to run; when it is finished, the app will close.</p>
<p>The script computes aggregated statistics, writes them to an Excel workbook, and creates visualizations of the results in a Word document. The R script is saved in the output directory and may be inspected, modified or re-run if needed.</p>
<p><img src="figures/Create_report.png"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kent S Johnson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
